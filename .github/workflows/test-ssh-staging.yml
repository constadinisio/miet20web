name: Test SSH Connection Staging

on:
  workflow_dispatch:

jobs:
  test-ssh:
    runs-on: ubuntu-latest

    steps:
      - name: Configurar clave SSH
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan -p ${{ secrets.SERVER2_PORT }} -H ${{ secrets.SERVER2_HOST }} >> ~/.ssh/known_hosts

      - name: Probar conexi√≥n SSH
        run: |
          echo "üîç Probando conexi√≥n a ${{ secrets.SERVER2_USER }}@${{ secrets.SERVER2_HOST }}:${{ secrets.SERVER2_PORT }}..."
          ssh -p ${{ secrets.SERVER2_PORT }} -o StrictHostKeyChecking=no \
            ${{ secrets.SERVER2_USER }}@${{ secrets.SERVER2_HOST }} "echo '‚úÖ Conexi√≥n SSH exitosa en STAGING: $(hostname)'; exit"

      - name: Confirmaci√≥n final
        run: echo "‚úÖ Test SSH completado con √©xito"
