name: Deploy Web Automático

on:
  push:
    branches:
      - main  # o el branch que uses

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Clonar el repositorio
        uses: actions/checkout@v3

      - name: Comprimir proyecto en .zip
        run: |
          zip -r proyecto_miet20web.zip miet20web

      - name: Subir el .zip al servidor
        uses: sebastianpopp/ftp-action@releases/v2
        with:
          host: ${{ secrets.FTP_HOST }}
          user: ${{ secrets.FTP_USER }}
          password: ${{ secrets.FTP_PASSWORD }}
          localDir: .
          remoteDir: /htdocs/
          onlyNewer: false
          include: |
            proyecto_miet20web.zip
          exclude: |
            *

      - name: Ejecutar descompresión en el servidor
        run: |
          curl http://54.233.210.17/descomprimir.php
